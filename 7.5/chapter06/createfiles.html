<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <title>
      6.6.&nbsp;创建必要的文件和链接
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
    <link rel="stylesheet" href="stylesheets/lfs-print.css" type="text/css"
    media="print" />
  </head>
  <body class="lfs" id="lfs-7.5">
    <div class="navheader">
      <h4>
        Linux From Scratch - 版本 7.5
      </h4>
      <h3>
        第&nbsp;6&nbsp;章&nbsp;安装基本系统软件
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="creatingdirs.html" title="创建目录">上一页</a>
          <p>
            创建目录
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="linux-headers.html" title=
          "Linux-3.13.3 API 头文件">下一页</a>
          <p>
            Linux-3.13.3 API 头文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter06.html" title=
          "第&nbsp;6&nbsp;章&nbsp;安装基本系统软件">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 7.5">起始页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="zh-cn" xml:lang="zh-cn">
      <h1 class="sect1">
        <a id="ch-system-createfiles" name="ch-system-createfiles"></a>6.6.
        创建必要的文件和链接
      </h1>
      <p>
        有些程序使用不可更改的路径指向现在还没有到位的程序。为了满足这些程序，创建一些符号链接，在本章中安装对应的软件之后它们会被真正的文件替代：
      </p>
      <pre class="userinput">
<kbd class="command">ln -sv /tools/bin/{bash,cat,echo,pwd,stty} /bin
ln -sv /tools/bin/perl /usr/bin
ln -sv /tools/lib/libgcc_s.so{,.1} /usr/lib
ln -sv /tools/lib/libstdc++.so{,.6} /usr/lib
sed 's/tools/usr/' /tools/lib/libstdc++.la &gt; /usr/lib/libstdc++.la
ln -sv bash /bin/sh</kbd>
</pre>
      <p>
        历史上，Linux 在 <code class="filename">/etc/mtab</code>
        文件中维护着一个被挂载文件系统的列表。现代内核在内部维护这个列表，并通过 <code class=
        "filename">/proc</code> 文件系统暴露给用户。为满足那些需要 <code class=
        "filename">/etc/mtab</code> 文件的工具，创建下面的符号链接：
      </p>
      <pre class="userinput">
<kbd class="command">ln -sv /proc/self/mounts /etc/mtab</kbd>
</pre>
      <p>
        为了让 <code class="systemitem">root</code> 用户能够登录并且要 <span class=
        "quote">“<span class="quote">root</span>”</span> 这个名字被识别，在
        <code class="filename">/etc/passwd</code> 和 <code class=
        "filename">/etc/group</code> 这两个文件中就要有对应的条目存在。
      </p>
      <p>
        运行以下命令创建 <code class="filename">/etc/passwd</code> 文件：
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; /etc/passwd &lt;&lt; "EOF"
<code class="literal">root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/dev/null:/bin/false
nobody:x:99:99:Unprivileged User:/dev/null:/bin/false</code>
EOF</kbd>
</pre>
      <p>
        <code class="systemitem">root</code> 用户的实际密码 (这里的 <span class=
        "quote">“<span class="quote">x</span>”</span> 只用作占位符) 稍后再设置。
      </p>
      <p>
        运行以下命令创建 <code class="filename">/etc/group</code> 文件：
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; /etc/group &lt;&lt; "EOF"
<code class="literal">root:x:0:
bin:x:1:
sys:x:2:
kmem:x:3:
tape:x:4:
tty:x:5:
daemon:x:6:
floppy:x:7:
disk:x:8:
lp:x:9:
dialout:x:10:
audio:x:11:
video:x:12:
utmp:x:13:
usb:x:14:
cdrom:x:15:
mail:x:34:
nogroup:x:99:</code>
EOF</kbd>
</pre>
      <p>
        创建的组并不是任何标准的一部分——它们一部分是本章中 Udev 配置的要求，另一部分是一些已有发行版的惯例。Linux 基础标准
        (LSB，位于 <a class="ulink" href=
        "http://www.linuxbase.org">http://www.linuxbase.org</a>) 只推荐
        <code class="systemitem">root</code> 组的 ID 为 0 并且 <code class=
        "systemitem">bin</code> 组的 ID 为 1。所有其他组的名称和 ID
        都可以由系统管理员自由选择，因为写得好的程序会使用组的名字而不是 ID。
      </p>
      <p>
        要移除 <span class="quote">“<span class="quote">I have no
        name!</span>”</span> 这个提示符，启动一个新的 shell。因为在 <a class="xref" href=
        "../chapter05/chapter05.html" title="第&nbsp;5&nbsp;章&nbsp;构建一个临时系统">第
        5 章</a> 中已经安装了完整的 Glibc 并且 <code class="filename">/etc/passwd</code>
        和 <code class="filename">/etc/group</code> 这两个文件也创建了，用户和组名称的解析就能够工作了：
      </p>
      <pre class="userinput">
<kbd class="command">exec /tools/bin/bash --login +h</kbd>
</pre>
      <p>
        注意使用 <em class="parameter"><code>+h</code></em> 参数。此项告知 <span class=
        "command"><strong>bash</strong></span>
        不要使用内置的路径哈希。没有这个参数，<span class="command"><strong>bash</strong></span>
        会记住执行过的二进制的路径。要确保新编译的二进制一旦安装就立刻使用， <em class=
        "parameter"><code>+h</code></em> 参数在本章的余下部分一直都要使用。
      </p>
      <p>
        <span class="command"><strong>login</strong></span>、<span class=
        "command"><strong>agetty</strong></span> 和 <span class=
        "command"><strong>init</strong></span> 程序 (还有其他一些)
        使用大量日志文件记录信息，例如谁在什么时候登录过系统。然而，如果日志文件不存在，这些程序就不会写入。初始化日志文件并且给出适当的权限：
      </p>
      <pre class="userinput">
<kbd class="command">touch /var/log/{btmp,lastlog,wtmp}
chgrp -v utmp /var/log/lastlog
chmod -v 664  /var/log/lastlog
chmod -v 600  /var/log/btmp</kbd>
</pre>
      <p>
        <code class="filename">/var/log/wtmp</code> 文件记录所有的登入登出。<code class=
        "filename">/var/log/lastlog</code> 文件记录每个用户上次登录的时间。<code class=
        "filename">/var/log/btmp</code> 文件记录失败的登录尝试。
      </p>
      <div class="admon note">
        <img alt="[注意]" src="../images/note.png" />
        <h3>
          注意
        </h3>
        <p>
          <code class="filename">/run/utmp</code> 文件记录当前登录的用户。此文件在引导脚本中动态创建。
        </p>
      </div>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="creatingdirs.html" title="创建目录">上一页</a>
          <p>
            创建目录
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="linux-headers.html" title=
          "Linux-3.13.3 API 头文件">下一页</a>
          <p>
            Linux-3.13.3 API 头文件
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter06.html" title=
          "第&nbsp;6&nbsp;章&nbsp;安装基本系统软件">上一级</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - 版本 7.5">起始页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
